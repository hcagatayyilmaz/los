generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id               String            @id @default(cuid())
  email            String            @unique
  firstName        String
  lastName         String
  profileImage     String?
  points           Int               @default(0)
  checkIns         CheckIn[]
  transactions     Transaction[]
  userBadges       UserBadge[]
  userHideAndSeeks UserHideAndSeek[]
  QuizAnswers      UserQuiz[]
  UserRewards      UserReward[]
}

enum AttractionTaxonomy {
  ATTRACTION
  EVENT
  EXPERIENCE
}

model Attraction {
  id           String              @id @default(cuid())
  taxonomy     AttractionTaxonomy?
  name         String
  latitude     Float
  longitude    Float
  points       Int
  cityId       String
  imageUrl     String?
  meta         Json?
  isActive     Boolean             @default(true)
  endDate      DateTime?
  startDate    DateTime?
  city         City                @relation(fields: [cityId], references: [id])
  checkIns     CheckIn[]
  hideAndSeeks HideAndSeek[]
}

model CheckIn {
  id           String     @id @default(cuid())
  userId       String
  attractionId String
  user         User       @relation(fields: [userId], references: [id])
  attraction   Attraction @relation(fields: [attractionId], references: [id])
  createdAt    DateTime   @default(now())

  @@unique([userId, attractionId])
}

model City {
  id          String       @id @default(cuid())
  name        String       @unique
  slug        String       @unique
  meta        Json?
  attractions Attraction[]
}

model Reward {
  id           String        @id @default(cuid())
  name         String
  points       Int
  meta         Json
  available    Boolean       @default(true)
  transactions Transaction[]
  startAt      DateTime?
  endAt        DateTime?
  userRewards  UserReward[]
}

model UserReward {
  id        String   @id @default(cuid())
  userId    String
  rewardId  String
  user      User     @relation(fields: [userId], references: [id])
  reward    Reward   @relation(fields: [rewardId], references: [id])
  createdAt DateTime @default(now())
  isUsed    Boolean  @default(false)

  @@unique([userId, rewardId])
}

enum TransactionType {
  EARN_POINTS
  SPEND_POINTS
}

model Transaction {
  id        String          @id @default(cuid())
  userId    String
  rewardId  String? // Make this field nullable
  points    Int
  details   String
  user      User            @relation(fields: [userId], references: [id])
  reward    Reward?         @relation(fields: [rewardId], references: [id])
  createdAt DateTime        @default(now())
  type      TransactionType

  @@unique([userId, rewardId])
}

model Badge {
  id            String      @id @default(cuid())
  name          String
  description   Json
  points        Int
  attractionIds String[]
  meta          Json
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  users         UserBadge[]
}

model UserBadge {
  id        String   @id @default(cuid())
  userId    String
  badgeId   String
  user      User     @relation(fields: [userId], references: [id])
  badge     Badge    @relation(fields: [badgeId], references: [id])
  createdAt DateTime @default(now())

  @@unique([userId, badgeId])
}

model HideAndSeek {
  id               String            @id @default(cuid())
  name             String?
  description      String?
  endDate          DateTime
  points           Int
  attractionId     String
  active           Boolean           @default(true)
  attraction       Attraction        @relation(fields: [attractionId], references: [id])
  meta             Json
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  userHideAndSeeks UserHideAndSeek[]
}

model UserHideAndSeek {
  id            String      @id @default(cuid())
  userId        String
  hideAndSeekId String
  user          User        @relation(fields: [userId], references: [id])
  hideAndSeek   HideAndSeek @relation(fields: [hideAndSeekId], references: [id])
  createdAt     DateTime    @default(now())
  attractionId  String?

  @@unique([userId, hideAndSeekId])
}

model Quiz {
  id          String     @id @default(cuid())
  meta        Json
  answer      String
  points      Int
  active      Boolean    @default(true)
  createdAt   DateTime   @default(now())
  endDate     DateTime?
  QuizAnswers UserQuiz[]
}

model UserQuiz {
  id               String   @id @default(cuid())
  userId           String
  quizId           String
  submitted_answer String
  user             User     @relation(fields: [userId], references: [id])
  quiz             Quiz     @relation(fields: [quizId], references: [id])
  createdAt        DateTime @default(now())

  @@unique([userId, quizId])
}
